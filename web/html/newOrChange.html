<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/newOrChange.css">
    <script src="../api/api.js"></script>
</head>

<body>
    <header>
        <h1 id="titulo">Gerenciamento de Produtos</h1>
    </header>
    <main>
        <h2><strong>Incluir novo produto</strong></h2>

        <section>
            <div>
                <p>Produto</p>
                <input type="text" id="name" required>
            </div>

            <div>
                <p>Fabricante</p>
                <input type="text" id="manufacturer" required>
            </div>

            <div>
                <p>Preço</p>
                <input type="number" id="price" required>
            </div>

            <div>
                <p>Quantidade em estoque</p>
                <input type="number" id="quantity" required>
            </div>
        </section>

        <aside>
            <p>Descrição do produto</p>
            <input type="text" id="description" required>
        </aside>

        <button onclick="salvar()">Salvar</button>
    </main>
</body>
<script>
    const ParametroUrl = new URLSearchParams(window.location.search);
    const productId = ParametroUrl.get('id');
    const productForEdit = null;

    if(productId){
        console.log("EDITAR!!!" + productId)
        carregarProduto(productId);
    }

     function salvar() {
        const dados = {
            name: document.getElementById('name').value,
            manufacturer: document.getElementById('manufacturer').value,
            price: parseFloat(document.getElementById('price').value),
            quantity: parseInt(document.getElementById('quantity').value),
            description: document.getElementById('description').value
        };

        if (!name || !manufacturer || !price || !quantity || !description) {
        alert("Todos os campos são obrigatórios!");
        return; 
        }

        if (description.length < 10) {
        alert("A descrição deve ter no mínimo 10 caracteres!");
        return;
        }



        if(productId) {
            updateProduct(productId, dados);
        } else {
            
            saveProduct(dados);
        }
    }
    async function carregarProduto(id) {
        const produto = await getProductById(id);
        
        if(produto) {
            document.getElementById("titulo").innerHTML = `Alterar produto - ID ${id}`;
    
            document.getElementById('name').value = produto.name;
            document.getElementById('manufacturer').value = produto.manufacturer;
            document.getElementById('price').value = produto.price;
            document.getElementById('quantity').value = produto.quantity;
            document.getElementById('description').value = produto.description;
        }
    }
    
</script>
</html>